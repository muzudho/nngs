# nngs

勉強しようぜ☆（＾～＾）  
Git hub のフォークの使い方が分からん☆（＾～＾）どうなってるんだぜ☆（＾～＾）？  

* [NNGS1.1.22のDocker化](https://github.com/muzudho/nngs-docker)
* ここは、勉強のレポジトリ☆（＾～＾）

## NNGS SERVER の README を読もうぜ☆（＾～＾）

(^q^) Linuxの圧縮形式の tarball に含まれているこのファイルは  
No Name Go Server(NNGS)のソースコードです。  

ライセンスは COPYING ファイルを見て。  


## 設定ファイルが変った☆（＾～＾）

(^q^) 設定ファイルの構成が変ったらしいが、初めてみるわたしには関係ないしな☆  

(^q^) 設定は 単一の nngs.cnf ファイルにまとめました。  
`./configure` コマンドを実行すると ほとんど構成終わり☆  

(^q^) そのコマンドで 既存の設定ファイルへの移行をやってくれたらしい☆  
わたしには関係ないな☆（＾～＾）  

(^q^) その設定には、ファイルとディレクトリーに関する項目がある。それらがおかしいと、おかしくなる☆  

(^q^) 起動時に 設定ファイルがなければ、デフォルトのを勝手に作る。  

(^q^)
(1) 前述のように設定ファイルを処理する☆  
(2) そのあと nngssrv は カレント・ディレクトリに 'written.cnf' を書き出す。  
フォーマットは 設定ファイルと同じ。この内容がプログラムで実際に使われている設定☆  

## インストールについて☆（＾～＾）

(^q^) NNGS は、使っていなくても mlrate が必要です☆ なんてこった☆（＾～＾）  
残念なことにオリジナルの（pemの）mlrate は autoconfd/automaked (AC/AM) ではありません☆ 何それ☆（＾～＾）  

(^q^) あなたが AC/AM を手に入れられなかったなら、手動で `src/` ディレクトリーの下にそれらを移動してください☆（＾～＾）  

Step 1:  

(^q^) NNGS を設定する前に mlrate の構成とコンパイルをしろ☆  
次のようにしろ（バージョン番号は異なることがある）  

```shell
# tar xvzf mlrate-1.0.xx.tar.gz
# cd mlrate-1.0.xx
# ./configure
# make
# cd ..
```

(^q^) mlrate ディレクトリーの README ファイルを読め☆  
レーティング・システムを働かせる有用な情報がある☆  

step 2:  

tarball を解凍しろ、mlrate ディレクトリーへシンボリック・リンクを貼れ、  

```shell
# tar xvzf nngs-1.1.yy.tar.gz
# cd nngs-1.1.yy
# ln -s ../mlrate-1.0.xx mlrate
# ./configure --prefix=/whatever/dir/you/want/to/install/it/in/
# make
# make install
```

(^q^)'make install' コマンドは サーバーの機能を働かせるために必要なすべての基本的なヘルプファイルを  
インストールするぜ☆ しなかったと思うけどなあ☆（＾～＾）  

(^q^)サーバーに必要なすべてのファイルは、 --prefix の下にインストールされる☆  
そのディレクトリーは NNGSバイナリが書込み可能にしろ☆  
data (players,games,logfile) ファイルもその下に入れる☆  
サーバーの実行によって それらのファイルはでかくなるから定期的にチェックしろよ☆  

--prefix には絶対パスを指定するのかだぜ☆（＾～＾）？

To run and test it:  

```shell
# $prefix/bin/nngssrv &
# telnet localhost 9696
```

## (^q^) NNGSの古いバージョンをお持ちの方へ☆

いないだろこの章飛ばせだぜ☆（＾～＾）  

(^q^) --prefix は古いバージョンを持ってるやつへの対策だったようだな☆  

## データ ファイル

(^q^) データとログファイルは $prefix/share/nngssrv/* にある☆  
設定ファイルで設定しろ☆  
`$prefix/share/nngssrv/*` に入れるやつと、 `$prefix/nngssrv/*` に入れるやつがあって ややこしいぜ☆（＾～＾）  

(^q^) 損傷を避けるために、いくつかのファイルは自動ではインストールしない。  
手動でインストールしろ☆  
`$prefix/nngssrv/ladder` には２つの ladder ファイルの例がある☆  
末尾の '.example' を削除するとか☆  

(^q^) `$prefix/nngssrv/messages` には ログイン、ログアウトなどの  
デフォルトメッセージがある☆  
'default.' を削除すればアクティブになる☆  

## (^q^) 代りの場所を設定するなら☆

(^q^) 起動時に、 nngssrv は カレント・ディレクトリにある nngs.cnf ファイルから  
設定を読み込もうとする☆  
または `-c pathname` で指定しろ☆  
(^q^) 再コンパイル不要、起動するだけでいい☆　ということかだぜ☆（＾～＾）  

(^q^) データと nngssrv バイナリを別の場所に置くことができる☆  
または、 ログファイルを `/var/` の中に置くことができる☆  
しかし ワイルドな選択をしないことをおススメする ;-)  

最も簡単な設定方法:  

1. NNGS を設定し、コンパイルし、インストールする☆
2. バイナリを開始。そしてそれを強制終了☆
3. 現在のディレクトリに書き出された nngs.cnf を編集☆ 設定ファイルには 一目瞭然のコメントが書いてある☆
4. 将来のバージョンでは おそらくさらに設定ファイルに項目が追加されるでしょう☆  
   可能な追加については、 nngs.cnf または written.cnf を調べてください☆

## chroot() なんか要らんので削除☆（＾～＾）

消した☆（＾～＾）  

## ユーザーと管理者

(^q^) サーバー起動時に管理者アカウントがなければ勝手に追加される☆  
**パスワードは設定されていないので、すぐに設定しろだぜ☆**  

NOTE: admin-status は２箇所に保存される☆: 適切な userfile と、 lists/admin ファイル。 両方必要。  
NOTE2: NNGSサーバーの実行中は ほとんどのファイルをメモリ上にキャッシュして使っているので  
元のファイルを編集しても反映されない。安全のために、サーバーを止めてからファイルを編集しろ☆  

admin ユーザーは lists/admins.default ファイルに既にあります。  
次のことを行う必要があります。  
1. `register` コマンドを使ってログインして 'admin' という名前のユーザーを作成しろ、そしてログアウトしろ☆
2. (a) サーバー止めろ☆  
(b) 手動で `.../players/a/admin` の中にある 'admin' ユーザーファイルを編集しろ☆

change the line:  

```plain
VARS: 1:4:0:1:0:1:1:0 :0:1:1:0:1:1:0:0 :0:0:0:0:0:0:0:0 :0:4:1:3:90:19:10:25 :33:0:0:33
   to:
VARS: 1:4:0:1:0:1:1:0 :0:1:1:0:1:1:0:0 :0:100:0:0:0:0:0:0 :0:4:1:3:90:19:10:25 :33:0:0:33
   (this field is the adminLevel)---------^^^
```

3. (a) サーバーを再起動しろ☆  
(b) 次回のログオンから、 'admin' アカウントには無制限の権限がある☆

## 開発

メンテナンスされてんのかなあ☆（＾～＾）  

See:  

[<http://www.sourceforge.org/nngs>](http://www.sourceforge.org/nngs)  

## 主な変更

* autoconf と automake で、多くの環境でコンパイルできる
* ソース・ツリーが綺麗
  * all help files
  * admin files etc.
  * included a 'make install' will install a working server
  * すべてのデータのディレクトリーを１箇所にまとめた☆ ($prefix/nngssrv)
  * インストール時にすべてのゲームとプレイヤーのディレクトリーを作った☆
  * 動的メモリ管理の local malloc() と salloc() は消した☆
* mlrate が綺麗になった☆
* ほとんどのコードから、フォーマット文字列は取り出した☆
* 国際化☆
  * chinese (messages and help files) (courtesy of LGS)
  * german (messages only)
  * ... others to follow
* いくつかのキャッシュを追加した☆ playerdb へ（から）の読み書きを減らすために☆
* ゲームの時計の解像度を 0.1秒に変えた☆
- 設定を .cnf ファイルへ移動した☆
- コンパイルされたファイル名をほとんど削除した☆　何のことやら☆（＾～＾）
- chroot() をサポートした☆
- 実験的な UDP ポート、 PHP/web インターフェースで使われる☆

### WINDOWS

サーバーは Windows でも動くようになった☆  
* cygwin (>=1.1.8) を http://www.cygwin.com からインストールして取ってこい☆
* 上記の手順の通りにコンパイルとインストールしろ☆
* 注: Windowsビルドは 2002年以降試されていません☆ YMMV.
